{% load joplin_tags %}

<!-- Modal -->
<div class="modal fade" id="createNewContentModal" tabindex="-1" role="dialog" aria-labelledby="createNewContentModalLabel">
  <div class="js-create-content-wizard-form">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="js-wizard-step content-modal__step--active" data-active="true">
            <h2>Select the Content Type</h2>
            <div class="button js-page-select" data-content-type="service">Service Page</div>
            <div class="button js-page-select" data-content-type="process">Process Page</div>
            <div class="button js-page-select" data-content-type="department">Department Page</div>
          </div>

          <div class="js-wizard-step content-modal__step--inactive" data-active="false">
            <h2>Select the Content Type</h2>
            <small>Character limit: 54</small>
            <label for="page-title">Page Title</label>
            <input type="text" id="page-title">
            <small>Example: Drop off hazardous wastes and other recyclables</small>
            <ul>
              <li>Use simple, accessible language</li>
              <li>Use words you think residents may search to find the service</li>
              <li>You don’t need to worry about including your department’s name in the title</li>
            </ul>

            <div class="modal-button-row">
              <div class="button js-back">Back</div>
              <button type="button" class="button" data-dismiss="modal">Close</button>
              <div class="button js-continue">Continue</div>
            </div>
          </div>

        </div>
          <div class="js-wizard-step content-modal__step--inactive" data-active="false">
            <h2>Select the topic  which best fits your content.</h2>
            {% themes %}
            <div class="modal-button-row" style="display: block;">
              <div class="button js-back">Back</div>
              <button type="button" class="button" data-dismiss="modal">Close</button>
              <div class="button js-continue js-select-topic" data-dismiss="modal">Continue</div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {

    var contentWizardState = {
      type: '',
      title: '',
      topic: '',
      activeStep: 0,
    }

    var contentWizardModule = {
      init: function() {
        console.log('setup contentWizardModule...');
        this.registerEventHandlers();
      },
      registerEventHandlers: function() {
        var thiz = this;
        console.log(this);

        $('.js-page-select').click( function() {
          contentWizardState.type = $(this).data('contentType');
          thiz.incrementActiveStep();
          console.log(contentWizardState);
        });

        $('.js-select-topic').click(function(e) {
          contentWizardState.topic = $('.js-topic-item:checked[name=topic]').val();
          console.log(contentWizardState);
          thiz.writeToLocalStorage();
          window.location.href = '/admin/pages/add/base/servicepage/3/';
        });

        $('#page-title').keyup(function(e) {
          console.log('#page-title keyup', e.target.value)
          contentWizardState.title = e.target.value;
        });

        $('.js-back').click( function(e) {
          e.preventDefault();
          console.log('js-back', contentWizardState);
          thiz.decrementActiveStep();
        });

        $('.js-continue').click( function(e) {
          thiz.incrementActiveStep();
        });

      },
      selectClickHandler: function(thing) {
      },
      incrementActiveStep: function(){
        contentWizardState.activeStep++;
        $('.js-wizard-step').each( function(i) {
          if (contentWizardState.activeStep === i) {
            $(this).addClass('content-modal__step--active');
            $(this).removeClass('content-modal__step--inactive');
          } else {
            $(this).removeClass('content-modal__step--active');
            $(this).addClass('content-modal__step--inactive');
          }
        });
      },
      decrementActiveStep: function(){
        contentWizardState.activeStep--
        $('.js-wizard-step').each( function(i) {
          if (contentWizardState.activeStep === i) {
            $(this).addClass('content-modal__step--active');
            $(this).removeClass('content-modal__step--inactive');
          } else {
            $(this).removeClass('content-modal__step--active');
            $(this).addClass('content-modal__step--inactive');
          }
        });
      },
      writeToLocalStorage: function() {
        localStorage.wagtailCreateModal = JSON.stringify(contentWizardState)
      }
    };

    contentWizardModule.init();
  })
</script>
