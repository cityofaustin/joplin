{% extends "wagtailadmin/pages/edit.html" %}

{% load render_bundle from webpack_loader %}
{% load wagtailadmin_tags %}
{% load joplin_tags %}
{% load i18n %}
{% load l10n %}
{% block titletag %}{% blocktrans with title=page.get_admin_display_title page_type=content_type.model_class.get_verbose_name %}Editing {{ page_type }}: {{ title }}{% endblocktrans %}{% endblock %}
{% block bodyclass %}page-editor {% if page.live %}page-is-live{% endif %} model-{{ content_type.model }} {% if page.locked %}page-locked{% endif %}{% endblock %}

{% block content %}
    {% get_style_guide_url content_type=content_type as style_guide_url %}
    {% page_permissions page as page_perms %}
    <script>
      // Load this before render_bundle to use django vars inside javascript
      var previewUrlData = {};
      try {
        // get python dictionary into valid JSON format
        previewUrlData=JSON.parse("{{page.preview_url_data|escapejs}}".replace(/\'/g, '\"'));
      } catch (e) {}

      var djangoData = {
        previewUrlData: previewUrlData,
        fallBackPreviewUrl: "{{ page.fallback_preview_url }}",
        styleGuideUrl: "{{ style_guide_url }}"
      }
    </script>
    <!-- Not a good pattern, not trying to keep it around -->
    <style>
      footer {
          display: none;
      }
    </style>
    {% render_bundle 'editor' %}
    <div class="header secondary">
        <div>
            <h1 class="edit_page_header">
                <span class="coa-page-action">Edit</span>
                <span class="page_title">{{ page.draft_title }}</span><br>
            </h1>
        </div>

        <div class="actions">

            <!-- SHARE -->
            <div class="coa-button--margin">
                <button id="page-share-preview-button" type="submit" form="page-edit-form"
                  class="coa-secondary-button button action-save button-longrunning icon coa-icon-share {% if is_revision %}warning{% endif %}"
                  data-clicked-text="{% trans 'Saving…' %}"
                  {% if page.locked %}disabled {% endif %}
                >
                  <span class="icon icon-spinner"></span>
                  <em>
                    {% if page.locked %}
                      {% trans 'Page locked' %}
                    {% else %}
                      {% if is_revision %}
                        {% trans 'Share current draft' %}
                      {% else %}
                        {% trans 'Share' %}
                      {% endif %}
                    {% endif %}
                  </em>
                </button>
                <div id="page-share-url-copied" class="hidden" >
                  <div> <span class="icon icon-success"></span> Draft preview URL copied to clipboard</div>
                  <div id="share-preview-url">{{ page.fallback_preview_url }}</div>
                </div>
            </div>

            <!-- PREVIEW -->
            <div class="coa-button--margin">
                <button id="page-preview-button" type="submit" form="page-edit-form"
                  class="coa-secondary-button button action-save button-longrunning icon icon-view {% if is_revision %}warning{% endif %}"
                  data-clicked-text="{% trans 'Saving…' %}"
                  {% if page.locked %}disabled {% endif %}
                >
                  <span class="icon icon-spinner"></span>
                  <em>
                    {% if page.locked %}
                      {% trans 'Page locked' %}
                    {% else %}
                      {% if is_revision %}
                        {% trans 'Preview current draft' %}
                      {% else %}
                        {% trans 'Preview' %}
                      {% endif %}
                    {% endif %}
                  </em>
                </button>
            </div>


            <!-- SAVE DRAFT -->
            <div class="dropdown dropdown-button {% if is_revision %}warning{% endif %} coa-button--margin">
              <div class="editor__save-button">
                {# Publish/Update should be primary action if page is live #}
                {% if page.live and page_perms.can_publish and not page.locked %}
                  {% include "wagtailadmin/pages/edit/publish_button.html" %}
                {% else %}
                  {% include "wagtailadmin/pages/edit/save_draft_button.html" %}
                {% endif %}
              </div>

              {% if not page.locked %}
                <div class="dropdown-toggle icon icon-arrow-down coa-dropdown--no-height"></div>
                <ul role="menu">
                  {# Save Draft should be secondary action if page is live #}
                  {% if page.live %}
                    {% include "wagtailadmin/pages/edit/save_draft_button.html" %}
                  {% else %}
                    {% if page_perms.can_publish %}
                      <li>
                        {% include "wagtailadmin/pages/edit/publish_button.html" %}
                      </li>
                    {% endif %}
                  {% endif %}
                  {% if not is_revision and page_perms.can_unpublish %}
                    <li>
                      <a href="{% url 'wagtailadmin_pages:unpublish' page.id %}">{% trans 'Unpublish' %}</a>
                    </li>
                  {% endif %}
                  {% if not is_revision and page_perms.can_delete %}
                    <li>
                      <a href="{% url 'wagtailadmin_pages:delete' page.id %}" class="shortcut">{% trans 'Delete' %}</a>
                    </li>
                  {% endif %}
                </ul>
              {% endif %}
            </div>

        </div>

    </div>
    <div class="secondary-actions">
    <div class="left">
      <section>
        <div class="field choice_field select">
            <div class="field-content coa-select">
                <div class="input">
                    <select name="select" id="language-select" >
                        <option id="en" selected>English</option>
                        <option id="es" >Spanish</option>
                        <option id="ar" >Arabic</option>
                        <option id="vi" >Vietnamese</option>
                    </select>
                    <span class="coa-select--arrow"></span>
                </div>
            </div>
        </div>
      </section>
      </div>
    <section class="coa-header__page-info">
    <div class="coa-header__page-revisions">
        <a href="{% url 'wagtailadmin_pages:revisions_index' page.id %}" class="underlined">Revisions</a>
    </div>
    <div class="coa-header__page-status">
    {% trans "Status:" %}
    {% include "wagtailadmin/shared/page_status_tag.html" with page=page_for_status %}
    </div>
    </section>
    </div>

    <div class="flex-container">

      <div class="edit-page-form-container">
        {{ block.super }}
      </div>

      {% include "wagtailadmin/pages/edit/sidebar-preview.html" %}

    </div>
{% endblock %}
