version: '3.7'
services:
  db:
    image: postgres:10
    ports:
      - "${JOPLIN_DB_PUBLIC_PORT}:${JOPLIN_DB_PUBLIC_PORT}" # previously 5432:5432
    environment:
      POSTGRES_DB: 'joplin'
      POSTGRES_USER: 'joplin'
    command: -p $JOPLIN_DB_PUBLIC_PORT
  app:
    # build settings are set in override file
    ports:
      - "${JOPLIN_APP_PUBLIC_PORT}:80" # previously 8000:80
    environment:
      LOAD_DATA: $LOAD_DATA
      MIGRATION_TEST: $MIGRATION_TEST
      HEROKU_KEY: $HEROKU_KEY
      DEBUG: 1
      GUNICORN_CMD_ARGS: "--reload  --reload-engine=poll"
      JANIS_URL: http://localhost:3000
      STYLEGUIDE_URL: https://cityofaustin.github.io/digital-services-style-guide
      DEPLOYMENT_MODE: "LOCAL"
      DATABASE_URL: "postgres://joplin@db:${JOPLIN_DB_PUBLIC_PORT}/joplin"
    depends_on:
      - "db"
  # "assets" service is used in docker-compose.local_override.yml
